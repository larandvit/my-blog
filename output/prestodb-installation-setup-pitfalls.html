<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml"><head><title>Trino(Presto) Installation and Setup Pitfalls - tech jogging</title><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="A personal blog includes technical articles aimed to share knowledge and experience with others."><link rel="canonical" href="https://techjogging.com/prestodb-installation-setup-pitfalls.html"><meta name="author" content="Vitaly Saversky"><meta name="description" content="Like other installations and setups, Trino formerly PrestoSQL can contain steps which cause difficulties. How many times you were stuck with something? In mostly cases, it was a trivial issue but you spent countless time to solve it. It's better to have a cheat sheet for discovering those issues before …"><meta property="og:site_name" content="tech jogging"><meta property="og:type" content="article"><meta property="og:title" content="Trino(Presto) Installation and Setup Pitfalls"><meta property="og:url" content="https://techjogging.com/prestodb-installation-setup-pitfalls.html"><meta property="og:description" content="Like other installations and setups, Trino formerly PrestoSQL can contain steps which cause difficulties. How many times you were stuck with something? In mostly cases, it was a trivial issue but you spent countless time to solve it. It's better to have a cheat sheet for discovering those issues before …"><meta property="article:published_time" content="2020-07-03"><meta property="article:section" content="Trino(Presto)"><meta property="article:author" content="Vitaly Saversky"><link rel="stylesheet" href="https://techjogging.com/theme/css/bootstrap.flatly.min.css" type="text/css"><link href="https://techjogging.com/theme/css/font-awesome.min.css" rel="stylesheet"><link href="https://techjogging.com/theme/css/pygments/monokai.css" rel="stylesheet"><link href="https://techjogging.com/theme/tipuesearch/tipuesearch.css" rel="stylesheet"><link rel="stylesheet" href="https://techjogging.com/theme/css/style.css" type="text/css"></head><body><div class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="https://techjogging.com/" class="navbar-brand"><img alt="tech jogging" class="img-responsive pull-left gap-right" src="https://techjogging.com/extra/site-logo.png" width> tech jogging </a></div><div class="collapse navbar-collapse navbar-ex1-collapse"><ul class="nav navbar-nav"><li><a href="https://techjogging.com/pages/about-blog.html"> About blog </a></li></ul><ul class="nav navbar-nav navbar-right"><li><span><form class="navbar-search" action="/search.html"><input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" pattern=".{3,}" title="At least 3 characters" required><button type="submit" class="tipue_search_button"><div class="tipue_search_icon">&#9906;</div></button></form></span></li></ul></div></div></div><div class="container"><div class="row"><div class="col-sm-9"><section id="content"><article><header class="page-header"><h1><a href="https://techjogging.com/prestodb-installation-setup-pitfalls.html" rel="bookmark" title="Permalink to Trino(Presto) Installation and Setup Pitfalls"> Trino(Presto) Installation and Setup Pitfalls </a></h1></header><div class="entry-content"><div class="panel"><div class="panel-body"><footer class="post-info"><span class="label label-default">Date</span><span class="published article-info-label"><i class="fa fa-calendar"></i><time datetime="2020-07-03T00:00:00-04:00"> 2020-07-03</time></span><span class="label label-default">Modified</span><span class="modified article-info-label"><i class="fa fa-calendar"></i><time datetime="2021-12-01T00:00:00-05:00"> 2021-12-01</time></span><span class="label label-default pageviews">Views</span><span class="article-info-label pageviews"><span class="badge pageviews" id="query-output"></span></span><span class="label label-default">Category</span><span class="article-info-label"><a href="https://techjogging.com/category/trinopresto.html">Trino(Presto)</a></span></footer></div></div><p>Like other installations and setups, <a href="https://trino.io/">Trino</a> formerly PrestoSQL can contain steps which cause difficulties. How many times you were stuck with something? In mostly cases, it was a trivial issue but you spent countless time to solve it. It's better to have a cheat sheet for discovering those issues before encountering them. The list of pitfalls is based on <a href="https://www.starburst.io/">Starburst</a> open-source distribution.</p><h2>History</h2><p><a href="https://trino.io/">Trino</a> formerly PrestoSQL was originated in 2012 year as <a href="https://prestodb.io/">PrestoDB</a> open-source project in Facebook. PrestoSQL was started in 2019 by the PrestoDB founders. Facebook forced to rebrand PrestoSQL into Trino in 2020. One of the successful commercial distribution based on Trino is <a href="https://www.starburst.io/">Starburst</a>. Starburst includes both open-source and commercial products.</p><h2>Disable swap on each node</h2><p>Trino assumes that swap is not used. Swap can dramatically impact on performance and stability of a Trino cluster. If swap is on, memory consumption will be close to 100% and, as a result, Trino cluster will be slow and many queries will fail.</p><p>The typical error messages are.</p><p>Error type 1.</p><div class="highlight"><pre><span></span>io.prestosql.spi.PrestoException: Query 20200720_132906_00038_4smph has not been accessed since 2020-07-20T09:42:25.080-04:00: currentTime 2020-07-20T09:52:25.447-04:00
</pre></div><p>Error type 2.</p><div class="highlight"><pre><span></span>io.prestosql.spi.PrestoTransportException: Encountered too many errors talking to a worker node. The node may have crashed or be under too much load. This is probably a transient issue, so please retry your query in a few minutes.
</pre></div><p>The current swappiness setting can be received.</p><div class="highlight"><pre><span></span>cat /proc/sys/vm/swappiness
</pre></div><p>Turn off swappiness temporary.</p><div class="highlight"><pre><span></span>sudo sysctl vm.swappiness<span class="o">=</span><span class="m">0</span>
</pre></div><p>Turn off swappiness permanently changing <code>vm.swappiness=0</code> setting in the file below.</p><div class="highlight"><pre><span></span>sudo nano /etc/sysctl.conf
</pre></div><p>Swap memory information.</p><div class="highlight"><pre><span></span>free -m
</pre></div><h2>Java 11 installation</h2><p><a href="https://openjdk.java.net/projects/jdk/11/">OpenJDK 11</a> can be used. Java 11 does not have JRE dedicated folder. </p><div class="highlight"><pre><span></span>sudo yum install java-11-openjdk-devel
</pre></div><p>OpenJDK JRE folder is <code>/usr/lib/jvm/jre-11</code>. It points to the same location as JDK one.</p><h2>SQL Server connector overwhelms SQL Server</h2><p>When data is written to SQL Server, Trino tries to do it as fast as possible. It will utilize all workers to push data to SQL Server. As a result, it opens a lot of connections at least one per worker and SQL Server can crash. Wideness of an exported table impacts on it as well. The more columns is in your table, the more chances to encounter the issue can be. Also, the number of records in a destination table contributes to the issue.</p><p>The error message is </p><div class="highlight"><pre><span></span>io.prestosql.spi.PrestoException: There is insufficient system memory in resource pool &#39;default&#39; to run this query. 
   at io.prestosql.plugin.jdbc.JdbcPageSink.appendPage(JdbcPageSink.java:117)
   at io.prestosql.operator.TableWriterOperator.addInput(TableWriterOperator.java:257)
   at io.prestosql.operator.Driver.processInternal(Driver.java:384)
   at io.prestosql.operator.Driver.lambda$processFor$8(Driver.java:283)
   at io.prestosql.operator.Driver.tryWithLock(Driver.java:675)
   at io.prestosql.operator.Driver.processFor(Driver.java:276)
   at io.prestosql.execution.SqlTaskExecution$DriverSplitRunner.processFor(SqlTaskExecution.java:1076)
   at io.prestosql.execution.executor.PrioritizedSplitRunner.process(PrioritizedSplitRunner.java:163)
   at io.prestosql.execution.executor.TaskExecutor$TaskRunner.run(TaskExecutor.java:484)
   at io.prestosql.$gen.Presto_348_e____20210219_123137_2.run(Unknown Source)
   at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
   at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
   at java.base/java.lang.Thread.run(Thread.java:834)
Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: There is insufficient system memory in resource pool &#39;default&#39; to run this query.
   at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:254)
   at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1608)
   at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.doExecutePreparedStatementBatch(SQLServerPreparedStatement.java:2766)
   at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement$PrepStmtBatchExecCmd.doExecute(SQLServerPreparedStatement.java:2641)
   at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:7240)
   at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLServerConnection.java:2869)
   at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(SQLServerStatement.java:243)
   at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(SQLServerStatement.java:218)
   at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.executeBatch(SQLServerPreparedStatement.java:2056)
   at io.prestosql.plugin.jdbc.JdbcPageSink.appendPage(JdbcPageSink.java:109)
   ... 12 more
</pre></div><p>To solve the issue, RAM of SQL Server should be pumped up. You can try to increase SQL Server memory until the issue is gone. For example, if you export a table with 100 columns and your record count is some hundred million records, RAM can be set up to 96GB with 90GB dedicated to SQL Server.</p><h2>Permissions for /tmp folder if Hive connector used</h2><p><code>/tmp</code> folder has to have the permissions in case of using Hive connector.</p><div class="highlight"><pre><span></span>ls -ld /tmp
drwxrwxrwx. <span class="m">13</span> root root <span class="m">4096</span> Jul <span class="m">30</span> <span class="m">15</span>:08 /tmp
</pre></div><p>Trino copies Hive connector files in <code>/tmp</code> folder during Trino server starup.</p><p>The location of the temporary folder can be changes with <code>-Djava.io.tmpdir</code> property in jvm.config file.</p><p>If <code>/tmp</code> folder is not granted emough permissions, Trino server will not start.</p><p>server.log error message when Hive connector is being loaded.</p><div class="highlight"><pre><span></span>2021-07-30T14:09:22.395-0400 INFO main io.trino.metadata.StaticCatalogStore -- Loading catalog /etc/starburst/catalog/hive_connector.properties --
...
2021-07-30T14:09:23.815-0400    ERROR   main    io.trino.server.Server  null
java.lang.ExceptionInInitializerError
    at io.trino.plugin.hive.HdfsEnvironment$$FastClassByGuice$$e99ee3bd.newInstance(&lt;generated&gt;)
    at com.google.inject.internal.DefaultConstructionProxyFactory$FastClassProxy.newInstance(DefaultConstructionProxyFactory.java:89)
    at com.google.inject.internal.ConstructorInjector.provision(ConstructorInjector.java:114)
    at com.google.inject.internal.ConstructorInjector.access$000(ConstructorInjector.java:32)
    at com.google.inject.internal.ConstructorInjector$1.call(ConstructorInjector.java:98)
    at com.google.inject.internal.ProvisionListenerStackCallback$Provision.provision(ProvisionListenerStackCallback.java:112)
    at io.airlift.bootstrap.LifeCycleModule.provision(LifeCycleModule.java:54)
    at com.google.inject.internal.ProvisionListenerStackCallback$Provision.provision(ProvisionListenerStackCallback.java:120)
    at com.google.inject.internal.ProvisionListenerStackCallback.provision(ProvisionListenerStackCallback.java:66)
    at com.google.inject.internal.ConstructorInjector.construct(ConstructorInjector.java:93)
    at com.google.inject.internal.ConstructorBindingImpl$Factory.get(ConstructorBindingImpl.java:306)
    at com.google.inject.internal.ProviderToInternalFactoryAdapter.get(ProviderToInternalFactoryAdapter.java:40)
    at com.google.inject.internal.SingletonScope$1.get(SingletonScope.java:168)
    at com.google.inject.internal.InternalFactoryToProviderAdapter.get(InternalFactoryToProviderAdapter.java:39)
    at com.google.inject.internal.SingleParameterInjector.inject(SingleParameterInjector.java:42)
    at com.google.inject.internal.SingleParameterInjector.getAll(SingleParameterInjector.java:65)
    at com.google.inject.internal.ConstructorInjector.provision(ConstructorInjector.java:113)
    at com.google.inject.internal.ConstructorInjector.access$000(ConstructorInjector.java:32)
    at com.google.inject.internal.ConstructorInjector$1.call(ConstructorInjector.java:98)
    at com.google.inject.internal.ProvisionListenerStackCallback$Provision.provision(ProvisionListenerStackCallback.java:112)
    at io.airlift.bootstrap.LifeCycleModule.provision(LifeCycleModule.java:54)
    at com.google.inject.internal.ProvisionListenerStackCallback$Provision.provision(ProvisionListenerStackCallback.java:120)
    at com.google.inject.internal.ProvisionListenerStackCallback.provision(ProvisionListenerStackCallback.java:66)
    at com.google.inject.internal.ConstructorInjector.construct(ConstructorInjector.java:93)
    at com.google.inject.internal.ConstructorBindingImpl$Factory.get(ConstructorBindingImpl.java:306)
    at com.google.inject.internal.FactoryProxy.get(FactoryProxy.java:62)
    at com.google.inject.internal.ProviderToInternalFactoryAdapter.get(ProviderToInternalFactoryAdapter.java:40)
    at com.google.inject.internal.SingletonScope$1.get(SingletonScope.java:168)
    at com.google.inject.internal.InternalFactoryToProviderAdapter.get(InternalFactoryToProviderAdapter.java:39)
    at com.google.inject.internal.InternalInjectorCreator.loadEagerSingletons(InternalInjectorCreator.java:213)
    at com.google.inject.internal.InternalInjectorCreator.injectDynamically(InternalInjectorCreator.java:184)
    at com.google.inject.internal.InternalInjectorCreator.build(InternalInjectorCreator.java:111)
    at com.google.inject.Guice.createInjector(Guice.java:87)
    at io.airlift.bootstrap.Bootstrap.initialize(Bootstrap.java:276)
    at io.trino.plugin.hive.InternalHiveConnectorFactory.createConnector(InternalHiveConnectorFactory.java:117)
    at io.trino.plugin.hive.InternalHiveConnectorFactory.createConnector(InternalHiveConnectorFactory.java:77)
    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.base/java.lang.reflect.Method.invoke(Method.java:566)
    at io.trino.plugin.hive.HiveConnectorFactory.create(HiveConnectorFactory.java:63)
    at io.trino.connector.ConnectorManager.createConnector(ConnectorManager.java:359)
    at io.trino.connector.ConnectorManager.createCatalog(ConnectorManager.java:216)
    at io.trino.connector.ConnectorManager.createCatalog(ConnectorManager.java:208)
    at io.trino.connector.ConnectorManager.createCatalog(ConnectorManager.java:194)
    at io.trino.metadata.StaticCatalogStore.loadCatalog(StaticCatalogStore.java:88)
    at io.trino.metadata.StaticCatalogStore.loadCatalogs(StaticCatalogStore.java:68)
    at io.trino.server.Server.doStart(Server.java:119)
    at io.trino.server.Server.lambda$start$0(Server.java:73)
    at io.trino.$gen.Trino_354_e____20210730_180904_1.run(Unknown Source)
    at io.trino.server.Server.start(Server.java:73)
    at com.starburstdata.presto.StarburstTrinoServer.main(StarburstTrinoServer.java:50)
Caused by: java.lang.RuntimeException: failed to load Hadoop native library
    at io.trino.hadoop.HadoopNative.requireHadoopNative(HadoopNative.java:59)
    at io.trino.plugin.hive.HdfsEnvironment.&lt;clinit&gt;(HdfsEnvironment.java:39)
    ... 52 more
Caused by: java.io.IOException: Permission denied
    at java.base/java.io.UnixFileSystem.createFileExclusively(Native Method)
    at java.base/java.io.File.createTempFile(File.java:2129)
    at java.base/java.io.File.createTempFile(File.java:2175)
    at io.trino.hadoop.HadoopNative.loadLibrary(HadoopNative.java:92)
    at io.trino.hadoop.HadoopNative.requireHadoopNative(HadoopNative.java:47)
    ... 53 more
</pre></div><h2>Error "FATAL: remaining connection slots are reserved for non-replication superuser connections"</h2><p>This issue might be caused by Event Logger with Postgres database as a backend when a Trino cluster is not stopped during shutting down Linux computers. In that case, Postgres connections are not closed and after Trino start, enough connections can't be allocated.</p><p>To solve it, restart your Trino cluster. It will release Postgres connections after stopping the cluster.</p><p>The issue was encountered in Starburst Enterprise edition 360-e.2.</p><p>The error message found in the server log.</p><div class="highlight"><pre><span></span>2021-10-02T10:47:21.873-0400    INFO    main    io.trino.eventlistener.EventListenerManager -- Loading event listener etc/event-listener.properties --
2021-10-02T10:47:22.424-0400    INFO    main    Bootstrap   PROPERTY                           DEFAULT     RUNTIME                                                                                DESCRIPTION
2021-10-02T10:47:22.424-0400    INFO    main    Bootstrap   jdbc.connection-pool.idle-timeout  10.00m      10.00m                                                                                 Maximum amount of time a connection can sit idle in the pool
2021-10-02T10:47:22.424-0400    INFO    main    Bootstrap   jdbc.password                      [REDACTED]  [REDACTED]                                                                             Password of the user connecting to the database
2021-10-02T10:47:22.424-0400    INFO    main    Bootstrap   jdbc.url                           ----        jdbc:postgresql://sample.com:5432/event_logger                                        URL of the database; for MySQL, include sessionVariables=sql_mode=ANSI
2021-10-02T10:47:22.424-0400    INFO    main    Bootstrap   jdbc.user                          ----        sample_user                                                                            User connecting to the database
2021-10-02T10:47:22.424-0400    INFO    main    Bootstrap   jdbc.connection-pool.max-size      10          10                                                                                     Maximum number of connections in the pool
2021-10-02T10:47:22.424-0400    INFO    main    Bootstrap   jdbc.connection-pool.min-size      1           1                                                                                      Minimum number of connections in the pool
2021-10-02T10:47:22.500-0400    INFO    main    com.zaxxer.hikari.HikariDataSource  HikariPool-1 - Starting...
2021-10-02T10:47:22.583-0400    ERROR   main    com.zaxxer.hikari.pool.HikariPool   HikariPool-1 - Exception during pool initialization.
org.postgresql.util.PSQLException: FATAL: remaining connection slots are reserved for non-replication superuser connections
    at org.postgresql.Driver$ConnectThread.getResult(Driver.java:410)
    at org.postgresql.Driver.connect(Driver.java:268)
    at java.sql/java.sql.DriverManager.getConnection(DriverManager.java:677)
    at java.sql/java.sql.DriverManager.getConnection(DriverManager.java:228)
    at org.postgresql.ds.common.BaseDataSource.getConnection(BaseDataSource.java:98)
    at org.postgresql.ds.common.BaseDataSource.getConnection(BaseDataSource.java:83)
    at com.zaxxer.hikari.pool.PoolBase.newConnection(PoolBase.java:353)
    at com.zaxxer.hikari.pool.PoolBase.newPoolEntry(PoolBase.java:201)
    at com.zaxxer.hikari.pool.HikariPool.createPoolEntry(HikariPool.java:473)
    at com.zaxxer.hikari.pool.HikariPool.checkFailFast(HikariPool.java:562)
    at com.zaxxer.hikari.pool.HikariPool.&lt;init&gt;(HikariPool.java:115)
    at com.zaxxer.hikari.HikariDataSource.&lt;init&gt;(HikariDataSource.java:81)
    at com.starburstdata.presto.eventlogger.api.db.PersistenceModule.createDatasource(PersistenceModule.java:77)
    at com.starburstdata.presto.eventlogger.api.db.PersistenceModule$$FastClassByGuice$$670968.GUICE$TRAMPOLINE(&lt;generated&gt;)
    at com.starburstdata.presto.eventlogger.api.db.PersistenceModule$$FastClassByGuice$$670968.apply(&lt;generated&gt;)
    at com.google.inject.internal.ProviderMethod$FastClassProviderMethod.doProvision(ProviderMethod.java:260)
    at com.google.inject.internal.ProviderMethod.doProvision(ProviderMethod.java:171)
    at com.google.inject.internal.InternalProviderInstanceBindingImpl$CyclicFactory.provision(InternalProviderInstanceBindingImpl.java:185)
    at com.google.inject.internal.InternalProviderInstanceBindingImpl$CyclicFactory.access$300(InternalProviderInstanceBindingImpl.java:139)
    at com.google.inject.internal.InternalProviderInstanceBindingImpl$CyclicFactory$1.call(InternalProviderInstanceBindingImpl.java:169)
    at com.google.inject.internal.ProvisionListenerStackCallback$Provision.provision(ProvisionListenerStackCallback.java:109)
    at io.airlift.bootstrap.LifeCycleModule.provision(LifeCycleModule.java:54)
    at com.google.inject.internal.ProvisionListenerStackCallback$Provision.provision(ProvisionListenerStackCallback.java:117)
    at com.google.inject.internal.ProvisionListenerStackCallback.provision(ProvisionListenerStackCallback.java:66)
    at com.google.inject.internal.InternalProviderInstanceBindingImpl$CyclicFactory.get(InternalProviderInstanceBindingImpl.java:164)
    at com.google.inject.internal.ProviderToInternalFactoryAdapter.get(ProviderToInternalFactoryAdapter.java:40)
    at com.google.inject.internal.SingletonScope$1.get(SingletonScope.java:169)
    at com.google.inject.internal.InternalFactoryToProviderAdapter.get(InternalFactoryToProviderAdapter.java:45)
    at com.google.inject.internal.InternalInjectorCreator.loadEagerSingletons(InternalInjectorCreator.java:213)
    at com.google.inject.internal.InternalInjectorCreator.injectDynamically(InternalInjectorCreator.java:186)
    at com.google.inject.internal.InternalInjectorCreator.build(InternalInjectorCreator.java:113)
    at com.google.inject.Guice.createInjector(Guice.java:87)
    at io.airlift.bootstrap.Bootstrap.initialize(Bootstrap.java:275)
    at com.starburstdata.presto.eventlogger.QueryLoggerEventListenerFactory.create(QueryLoggerEventListenerFactory.java:40)
    at com.starburstdata.presto.license.LicenceCheckingEventListenerFactory.create(LicenceCheckingEventListenerFactory.java:50)
    at io.trino.eventlistener.EventListenerManager.createEventListener(EventListenerManager.java:117)
    at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:195)
    at java.base/java.util.Collections$2.tryAdvance(Collections.java:4747)
    at java.base/java.util.Collections$2.forEachRemaining(Collections.java:4755)
    at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:484)
    at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:474)
    at java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:913)
    at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
    at java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:578)
    at io.trino.eventlistener.EventListenerManager.configuredEventListeners(EventListenerManager.java:100)
    at io.trino.eventlistener.EventListenerManager.loadEventListeners(EventListenerManager.java:85)
    at io.trino.server.Server.doStart(Server.java:134)
    at io.trino.server.Server.lambda$start$0(Server.java:77)
    at io.trino.$gen.Trino_360_e_2____20211002_144649_1.run(Unknown Source)
    at io.trino.server.Server.start(Server.java:77)
    at com.starburstdata.presto.StarburstTrinoServer.main(StarburstTrinoServer.java:40)


2021-10-02T10:47:22.584-0400    ERROR   main    com.starburstdata.presto.eventlogger.api.db.PersistenceModule   Failed to create connection pool; query event logger will be disabled
com.zaxxer.hikari.pool.HikariPool$PoolInitializationException: Failed to initialize pool: FATAL: remaining connection slots are reserved for non-replication superuser connections
    at com.zaxxer.hikari.pool.HikariPool.throwPoolInitializationException(HikariPool.java:597)
    at com.zaxxer.hikari.pool.HikariPool.checkFailFast(HikariPool.java:576)
    at com.zaxxer.hikari.pool.HikariPool.&lt;init&gt;(HikariPool.java:115)
    at com.zaxxer.hikari.HikariDataSource.&lt;init&gt;(HikariDataSource.java:81)
    at com.starburstdata.presto.eventlogger.api.db.PersistenceModule.createDatasource(PersistenceModule.java:77)
    at com.starburstdata.presto.eventlogger.api.db.PersistenceModule$$FastClassByGuice$$670968.GUICE$TRAMPOLINE(&lt;generated&gt;)
    at com.starburstdata.presto.eventlogger.api.db.PersistenceModule$$FastClassByGuice$$670968.apply(&lt;generated&gt;)
    at com.google.inject.internal.ProviderMethod$FastClassProviderMethod.doProvision(ProviderMethod.java:260)
    at com.google.inject.internal.ProviderMethod.doProvision(ProviderMethod.java:171)
    at com.google.inject.internal.InternalProviderInstanceBindingImpl$CyclicFactory.provision(InternalProviderInstanceBindingImpl.java:185)
    at com.google.inject.internal.InternalProviderInstanceBindingImpl$CyclicFactory.access$300(InternalProviderInstanceBindingImpl.java:139)
    at com.google.inject.internal.InternalProviderInstanceBindingImpl$CyclicFactory$1.call(InternalProviderInstanceBindingImpl.java:169)
    at com.google.inject.internal.ProvisionListenerStackCallback$Provision.provision(ProvisionListenerStackCallback.java:109)
    at io.airlift.bootstrap.LifeCycleModule.provision(LifeCycleModule.java:54)
    at com.google.inject.internal.ProvisionListenerStackCallback$Provision.provision(ProvisionListenerStackCallback.java:117)
    at com.google.inject.internal.ProvisionListenerStackCallback.provision(ProvisionListenerStackCallback.java:66)
    at com.google.inject.internal.InternalProviderInstanceBindingImpl$CyclicFactory.get(InternalProviderInstanceBindingImpl.java:164)
    at com.google.inject.internal.ProviderToInternalFactoryAdapter.get(ProviderToInternalFactoryAdapter.java:40)
    at com.google.inject.internal.SingletonScope$1.get(SingletonScope.java:169)
    at com.google.inject.internal.InternalFactoryToProviderAdapter.get(InternalFactoryToProviderAdapter.java:45)
    at com.google.inject.internal.InternalInjectorCreator.loadEagerSingletons(InternalInjectorCreator.java:213)
    at com.google.inject.internal.InternalInjectorCreator.injectDynamically(InternalInjectorCreator.java:186)
    at com.google.inject.internal.InternalInjectorCreator.build(InternalInjectorCreator.java:113)
    at com.google.inject.Guice.createInjector(Guice.java:87)
    at io.airlift.bootstrap.Bootstrap.initialize(Bootstrap.java:275)
    at com.starburstdata.presto.eventlogger.QueryLoggerEventListenerFactory.create(QueryLoggerEventListenerFactory.java:40)
    at com.starburstdata.presto.license.LicenceCheckingEventListenerFactory.create(LicenceCheckingEventListenerFactory.java:50)
    at io.trino.eventlistener.EventListenerManager.createEventListener(EventListenerManager.java:117)
    at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:195)
    at java.base/java.util.Collections$2.tryAdvance(Collections.java:4747)
    at java.base/java.util.Collections$2.forEachRemaining(Collections.java:4755)
    at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:484)
    at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:474)
    at java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:913)
    at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
    at java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:578)
    at io.trino.eventlistener.EventListenerManager.configuredEventListeners(EventListenerManager.java:100)
    at io.trino.eventlistener.EventListenerManager.loadEventListeners(EventListenerManager.java:85)
    at io.trino.server.Server.doStart(Server.java:134)
    at io.trino.server.Server.lambda$start$0(Server.java:77)
    at io.trino.$gen.Trino_360_e_2____20211002_144649_1.run(Unknown Source)
    at io.trino.server.Server.start(Server.java:77)
    at com.starburstdata.presto.StarburstTrinoServer.main(StarburstTrinoServer.java:40)
Caused by: org.postgresql.util.PSQLException: FATAL: remaining connection slots are reserved for non-replication superuser connections
    at org.postgresql.Driver$ConnectThread.getResult(Driver.java:410)
    at org.postgresql.Driver.connect(Driver.java:268)
    at java.sql/java.sql.DriverManager.getConnection(DriverManager.java:677)
    at java.sql/java.sql.DriverManager.getConnection(DriverManager.java:228)
    at org.postgresql.ds.common.BaseDataSource.getConnection(BaseDataSource.java:98)
    at org.postgresql.ds.common.BaseDataSource.getConnection(BaseDataSource.java:83)
    at com.zaxxer.hikari.pool.PoolBase.newConnection(PoolBase.java:353)
    at com.zaxxer.hikari.pool.PoolBase.newPoolEntry(PoolBase.java:201)
    at com.zaxxer.hikari.pool.HikariPool.createPoolEntry(HikariPool.java:473)
    at com.zaxxer.hikari.pool.HikariPool.checkFailFast(HikariPool.java:562)
    ... 41 more
</pre></div><h2>Expected a string or numeric value for field 'field_name' of type VARCHAR: [value1, value2] [ArrayList]</h2><p>The error is encountered when Elasticsearch connector is used. The connector can handle only <a href="https://trino.io/docs/current/connector/elasticsearch.html#data-types">simple data types</a> but Elasticsearch includes list of values in a field.</p><p>The message is.</p><div class="highlight"><pre><span></span>SQL Error [58]: Query failed (#20211105_183725_88248_kz74f): Expected a string or numeric value for field &#39;field_name&#39; of type VARCHAR: [value1, value2, value3] [ArrayList]
</pre></div><p>To fix the issue, a command should be run to notify Trino about those fields in the _meta section of the index mapping. Replace those place holders with yours values: elastic.sample.com:9200, index_name, and field_name.</p><div class="highlight"><pre><span></span>curl --request PUT <span class="se">\</span>
    --url elastic.sample.com:9200/index_name/doc/_mapping <span class="se">\</span>
    --header <span class="s1">&#39;content-type: application/json&#39;</span> <span class="se">\</span>
    --data <span class="s1">&#39;</span>
<span class="s1">{</span>
<span class="s1">    &quot;_meta&quot;: {</span>
<span class="s1">        &quot;presto&quot;:{</span>
<span class="s1">            &quot;field_name&quot;:{</span>
<span class="s1">                &quot;isArray&quot;:true</span>
<span class="s1">            }</span>
<span class="s1">        }</span>
<span class="s1">    }</span>
<span class="s1">}&#39;</span>
</pre></div><p>The testing can be done running any of those SQL statements.</p><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">field_name</span> <span class="k">FROM</span> <span class="n">elastic_catalog</span><span class="p">.</span><span class="ss">&quot;default&quot;</span><span class="p">.</span><span class="n">index_name</span> <span class="k">WHERE</span> <span class="n">field_name</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">field_name</span> <span class="k">FROM</span> <span class="n">elastic_catalog</span><span class="p">.</span><span class="ss">&quot;default&quot;</span><span class="p">.</span><span class="n">index_name</span><span class="p">;</span>
</pre></div><p>Trino documentation reference is <a href="https://trino.io/docs/current/connector/elasticsearch.html#array-types">Array types</a>.</p></div><hr><section class="comments" id="comments"><h2>Comments</h2><div id="disqus_thread"></div><script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'techjogging'; // required: replace example with your forum shortname

            var disqus_config = function () {
                this.language = "en";

                        this.page.identifier = '2020-07-03-prestodb-installation-setup-pitfalls';
                        this.page.url = 'https://techjogging.com/prestodb-installation-setup-pitfalls.html';
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></section></article></section></div><div class="col-sm-3" id="sidebar"><aside><section class="well well-sm"><ul class="list-group list-group-flush"><li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4><ul class="list-group" id="recentposts"><li class="list-group-item"><a href="https://techjogging.com/cobol-character-data-type.html">COBOL Character Data Type</a></li><li class="list-group-item"><a href="https://techjogging.com/cobol-unsigned-binary-data-type.html">COBOL Unsigned BINARY Data Type</a></li><li class="list-group-item"><a href="https://techjogging.com/cobol-signed-binary-data-type.html">COBOL Signed BINARY Data Type</a></li><li class="list-group-item"><a href="https://techjogging.com/cobol-data-types.html">COBOL Data Types</a></li><li class="list-group-item"><a href="https://techjogging.com/convert-pem-file-format-java-keystore.html">Convert PEM File Format to Java Keystore</a></li></ul></li><li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categories</span></h4><ul class="list-group" id="categories"><li class="list-group-item"><a href="https://techjogging.com/category/cobol.html"><i class="fa fa-folder-open fa-lg"></i>COBOL</a></li><li class="list-group-item"><a href="https://techjogging.com/category/cron.html"><i class="fa fa-folder-open fa-lg"></i>Cron</a></li><li class="list-group-item"><a href="https://techjogging.com/category/dbeaver.html"><i class="fa fa-folder-open fa-lg"></i>DBeaver</a></li><li class="list-group-item"><a href="https://techjogging.com/category/docker.html"><i class="fa fa-folder-open fa-lg"></i>Docker</a></li><li class="list-group-item"><a href="https://techjogging.com/category/git.html"><i class="fa fa-folder-open fa-lg"></i>Git</a></li><li class="list-group-item"><a href="https://techjogging.com/category/google-analytics.html"><i class="fa fa-folder-open fa-lg"></i>Google Analytics</a></li><li class="list-group-item"><a href="https://techjogging.com/category/hardware.html"><i class="fa fa-folder-open fa-lg"></i>Hardware</a></li><li class="list-group-item"><a href="https://techjogging.com/category/hive.html"><i class="fa fa-folder-open fa-lg"></i>Hive</a></li><li class="list-group-item"><a href="https://techjogging.com/category/hubitat.html"><i class="fa fa-folder-open fa-lg"></i>Hubitat</a></li><li class="list-group-item"><a href="https://techjogging.com/category/kerberos.html"><i class="fa fa-folder-open fa-lg"></i>Kerberos</a></li><li class="list-group-item"><a href="https://techjogging.com/category/linux.html"><i class="fa fa-folder-open fa-lg"></i>Linux</a></li><li class="list-group-item"><a href="https://techjogging.com/category/microsoft-access.html"><i class="fa fa-folder-open fa-lg"></i>Microsoft Access</a></li><li class="list-group-item"><a href="https://techjogging.com/category/microsoft-excel.html"><i class="fa fa-folder-open fa-lg"></i>Microsoft Excel</a></li><li class="list-group-item"><a href="https://techjogging.com/category/minio.html"><i class="fa fa-folder-open fa-lg"></i>MinIO</a></li><li class="list-group-item"><a href="https://techjogging.com/category/ms-sql-server.html"><i class="fa fa-folder-open fa-lg"></i>MS SQL Server</a></li><li class="list-group-item"><a href="https://techjogging.com/category/nginx.html"><i class="fa fa-folder-open fa-lg"></i>Nginx</a></li><li class="list-group-item"><a href="https://techjogging.com/category/python.html"><i class="fa fa-folder-open fa-lg"></i>Python</a></li><li class="list-group-item"><a href="https://techjogging.com/category/security.html"><i class="fa fa-folder-open fa-lg"></i>Security</a></li><li class="list-group-item"><a href="https://techjogging.com/category/surveillance.html"><i class="fa fa-folder-open fa-lg"></i>Surveillance</a></li><li class="list-group-item"><a href="https://techjogging.com/category/synology-dsm.html"><i class="fa fa-folder-open fa-lg"></i>Synology DSM</a></li><li class="list-group-item"><a href="https://techjogging.com/category/talend.html"><i class="fa fa-folder-open fa-lg"></i>Talend</a></li><li class="list-group-item"><a href="https://techjogging.com/category/trinopresto.html"><i class="fa fa-folder-open fa-lg"></i>Trino(Presto)</a></li><li class="list-group-item"><a href="https://techjogging.com/category/virtualization.html"><i class="fa fa-folder-open fa-lg"></i>Virtualization</a></li><li class="list-group-item"><a href="https://techjogging.com/category/windows.html"><i class="fa fa-folder-open fa-lg"></i>Windows</a></li></ul></li></ul></section></aside></div></div></div><footer><div class="container"><hr><div class="row"><div class="col-xs-10">&copy; 2022 Vitaly Saversky &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>, <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>, <a href="http://getbootstrap.com" target="_blank">Bootstrap</a></div><div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i><a href="#">Back to top</a></p></div></div></div></footer><script src="https://techjogging.com/theme/js/jquery.min.js"></script><script src="https://techjogging.com/theme/js/bootstrap.min.js"></script><script src="https://techjogging.com/theme/js/respond.min.js"></script><script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'techjogging'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script><script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-156524189-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script><script src="https://techjogging.com/theme/js/report_access.js"></script><script type="text/javascript">
(function(w,d,s,g,js,fs){
  g=w.gapi||(w.gapi={});g.analytics={q:[],ready:function(f){this.q.push(f);}};
  js=d.createElement(s);fs=d.getElementsByTagName(s)[0];
  js.src='https://apis.google.com/js/platform.js';
  fs.parentNode.insertBefore(js,fs);js.onload=function(){g.load('analytics');};
}(window,document,'script'));
</script><script type="text/javascript">
gapi.analytics.ready(function() {

	  gapi.analytics.auth.authorize({
	    'serverAuth': {
	      'access_token': ANALYTICS_TOKEN
	    }
	  });
	  
	  var pagePathFilter = 'ga:pagePath==' + window.location.pathname;
	  
	  var report = new gapi.analytics.report.Data({
		  query: {
		    ids: 'ga:209816969',
		    'start-date': '2020-02-29',
		    'end-date': 'today',
		    metrics: 'ga:pageviews',
		    filters: pagePathFilter
		  }
		});

		report.on('success', function(response) {
			pageViews = response.totalsForAllResults['ga:pageviews'];
			if (pageViews!='0') {
				$('#query-output').text(pageViews);
				for (pageviewsElement of document.getElementsByClassName('pageviews')){
					pageviewsElement.style.display='initial';
				}
			}
		});

		report.execute();

	  
	});
</script></body></html>