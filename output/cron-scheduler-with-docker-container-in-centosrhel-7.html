<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml"><head><title>Cron Scheduler with Docker Container in CentOS/RHEL 7 - tech jogging</title><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="A personal blog includes technical articles aimed to share knowledge and experience with others."><link rel="canonical" href="/cron-scheduler-with-docker-container-in-centosrhel-7.html"><meta name="author" content="Vitaly Saversky"><meta name="description" content="Using cron with the official CentOS Docker image requests activating systemd, keeping container running, and opening a Docker container in privileged mode. CentOS Docker Hub image includes the description of the setup which should be done to activate systemd and keep a container going. The missing is information how to …"><meta property="og:site_name" content="tech jogging"><meta property="og:type" content="article"><meta property="og:title" content="Cron Scheduler with Docker Container in CentOS/RHEL 7"><meta property="og:url" content="/cron-scheduler-with-docker-container-in-centosrhel-7.html"><meta property="og:description" content="Using cron with the official CentOS Docker image requests activating systemd, keeping container running, and opening a Docker container in privileged mode. CentOS Docker Hub image includes the description of the setup which should be done to activate systemd and keep a container going. The missing is information how to …"><meta property="article:published_time" content="2020-02-18"><meta property="article:section" content="Docker"><meta property="article:author" content="Vitaly Saversky"><link rel="stylesheet" href="/theme/css/bootstrap.flatly.min.css" type="text/css"><link href="/theme/css/font-awesome.min.css" rel="stylesheet"><link href="/theme/css/pygments/monokai.css" rel="stylesheet"><link href="/theme/tipuesearch/tipuesearch.css" rel="stylesheet"><link rel="stylesheet" href="/theme/css/style.css" type="text/css"></head><body><div class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand"><img alt="tech jogging" class="img-responsive pull-left gap-right" src="/extra/site-logo.png" width> tech jogging </a></div><div class="collapse navbar-collapse navbar-ex1-collapse"><ul class="nav navbar-nav"><li><a href="/pages/about-blog.html"> About blog </a></li></ul><ul class="nav navbar-nav navbar-right"><li><span><form class="navbar-search" action="/search.html"><input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" pattern=".{3,}" title="At least 3 characters" required><button type="submit" class="tipue_search_button"><div class="tipue_search_icon">&#9906;</div></button></form></span></li></ul></div></div></div><div class="container"><div class="row"><div class="col-sm-9"><section id="content"><article><header class="page-header"><h1><a href="/cron-scheduler-with-docker-container-in-centosrhel-7.html" rel="bookmark" title="Permalink to Cron Scheduler with Docker Container in CentOS/RHEL 7"> Cron Scheduler with Docker Container in CentOS/RHEL 7 </a></h1></header><div class="entry-content"><div class="panel"><div class="panel-body"><footer class="post-info"><span class="label label-default">Date</span><span class="published article-info-label"><i class="fa fa-calendar"></i><time datetime="2020-02-18T00:00:00-05:00"> 2020-02-18</time></span><span class="label label-default pageviews">Views</span><span class="article-info-label pageviews"><span class="badge pageviews" id="query-output"></span></span><span class="label label-default">Category</span><span class="article-info-label"><a href="/category/docker.html">Docker</a>, <a href="/category/cron.html">Cron</a>, <a href="/category/linux.html">Linux</a></span></footer></div></div><p>Using cron with the official CentOS Docker image requests activating systemd, keeping container running, and opening a Docker container in privileged mode. CentOS Docker Hub image includes the description of the setup which should be done to activate systemd and keep a container going. The missing is information how to install and set up cron. This article provides a summary of steps and a functioning sample of Dockerfile. Some customization is needed to implement your cron project.</p><h2>Dockerfile</h2><p>The Dockerfile can be used as a template to design your file. After line #15, you can add your commands to install any packages. You need to replace line #20 with your time zone. Finally, line #22 shows how to add a scheduled job to crontab file.</p><div class="highlight"><pre><span></span>ROM centos:7

<span class="k">ENV</span> container docker

<span class="k">RUN</span> <span class="o">(</span><span class="nb">cd</span> /lib/systemd/system/sysinit.target.wants/<span class="p">;</span> <span class="k">for</span> i in *<span class="p">;</span> <span class="k">do</span> <span class="o">[</span> <span class="nv">$i</span> <span class="o">==</span> <span class="se">\</span>
systemd-tmpfiles-setup.service <span class="o">]</span> <span class="o">||</span> rm -f <span class="nv">$i</span><span class="p">;</span> <span class="k">done</span><span class="o">)</span><span class="p">;</span> <span class="se">\</span>
rm -f /lib/systemd/system/multi-user.target.wants/*<span class="p">;</span><span class="se">\</span>
rm -f /etc/systemd/system/*.wants/*<span class="p">;</span><span class="se">\</span>
rm -f /lib/systemd/system/local-fs.target.wants/*<span class="p">;</span> <span class="se">\</span>
rm -f /lib/systemd/system/sockets.target.wants/*udev*<span class="p">;</span> <span class="se">\</span>
rm -f /lib/systemd/system/sockets.target.wants/*initctl*<span class="p">;</span> <span class="se">\</span>
rm -f /lib/systemd/system/basic.target.wants/*<span class="p">;</span><span class="se">\</span>
rm -f /lib/systemd/system/anaconda.target.wants/*<span class="p">;</span>

<span class="k">VOLUME</span> <span class="p">[</span> <span class="s2">&quot;/sys/fs/cgroup&quot;</span> <span class="p">]</span>

<span class="k">RUN</span> yum install -y cronie <span class="o">&amp;&amp;</span> yum clean all

<span class="k">RUN</span> rm -rf /etc/localtime
<span class="k">RUN</span> ln -s /usr/share/zoneinfo/America/Toronto /etc/localtime

<span class="k">RUN</span> crontab -l <span class="p">|</span> <span class="o">{</span> cat<span class="p">;</span> <span class="nb">echo</span> <span class="s2">&quot;25 04 * * sun,mon,tue python3 /app/do_maintenance.py&quot;</span><span class="p">;</span> <span class="o">}</span> <span class="p">|</span> crontab -

<span class="k">CMD</span> <span class="p">[</span><span class="s2">&quot;/usr/sbin/init&quot;</span><span class="p">]</span>
</pre></div><h3>Dockerfile logical parts</h3><ul><li><p>Activating systemd.</p><div class="highlight"><pre><span></span><span class="k">RUN</span> <span class="o">(</span><span class="nb">cd</span> /lib/systemd/system/sysinit.target.wants/<span class="p">;</span> <span class="k">for</span> i in *<span class="p">;</span> <span class="k">do</span> <span class="o">[</span> <span class="nv">$i</span> <span class="o">==</span> <span class="se">\</span>
systemd-tmpfiles-setup.service <span class="o">]</span> <span class="o">||</span> rm -f <span class="nv">$i</span><span class="p">;</span> <span class="k">done</span><span class="o">)</span><span class="p">;</span> <span class="se">\</span>
rm -f /lib/systemd/system/multi-user.target.wants/*<span class="p">;</span><span class="se">\</span>
rm -f /etc/systemd/system/*.wants/*<span class="p">;</span><span class="se">\</span>
rm -f /lib/systemd/system/local-fs.target.wants/*<span class="p">;</span> <span class="se">\</span>
rm -f /lib/systemd/system/sockets.target.wants/*udev*<span class="p">;</span> <span class="se">\</span>
rm -f /lib/systemd/system/sockets.target.wants/*initctl*<span class="p">;</span> <span class="se">\</span>
rm -f /lib/systemd/system/basic.target.wants/*<span class="p">;</span><span class="se">\</span>
rm -f /lib/systemd/system/anaconda.target.wants/*<span class="p">;</span>

<span class="k">VOLUME</span> <span class="p">[</span> <span class="s2">&quot;/sys/fs/cgroup&quot;</span> <span class="p">]</span>
</pre></div></li><li><p>Install cron.</p><div class="highlight"><pre><span></span><span class="k">RUN</span> yum install -y cronie <span class="o">&amp;&amp;</span> yum clean all
</pre></div></li><li><p>Set up your time zone.</p><div class="highlight"><pre><span></span><span class="k">RUN</span> rm -rf /etc/localtime
<span class="k">RUN</span> ln -s /usr/share/zoneinfo/America/Toronto /etc/localtime
</pre></div></li><li><p>Add a job in crontab file.</p><div class="highlight"><pre><span></span><span class="k">RUN</span> crontab -l <span class="p">|</span> <span class="o">{</span> cat<span class="p">;</span> <span class="nb">echo</span> <span class="s2">&quot;25 04 * * sun,mon,tue python3 /app/do_maintenance.py&quot;</span><span class="p">;</span> <span class="o">}</span> <span class="p">|</span> crontab -
</pre></div></li><li><p>Keep container running.</p><div class="highlight"><pre><span></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&quot;/usr/sbin/init&quot;</span><span class="p">]</span>
</pre></div></li></ul><h2>Build conatiner</h2><p>The image name is c7-cron and it's designated as local one.</p><div class="highlight"><pre><span></span>docker build --rm -t local/c7-cron .
</pre></div><h2>Run container</h2><p>To create and start a container, use the command.</p><div class="highlight"><pre><span></span>docker run --privileged --name<span class="o">=</span>parking –v /sys/fs/cgroup:/sys/fs/cgroup:ro -d local/c7-cron
</pre></div><p>To access the container in a terminal, run the command.</p><div class="highlight"><pre><span></span>docker <span class="nb">exec</span> -it parking /bin/bash
</pre></div></div><hr><section class="comments" id="comments"><h2>Comments</h2><div id="disqus_thread"></div><script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'techjogging'; // required: replace example with your forum shortname

            var disqus_config = function () {
                this.language = "en";

                        this.page.identifier = '2020-02-18-cron-scheduler-with-docker-container-in-centosrhel-7';
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></section></article></section></div><div class="col-sm-3" id="sidebar"><aside><section class="well well-sm"><ul class="list-group list-group-flush"><li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4><ul class="list-group" id="recentposts"><li class="list-group-item"><a href="/set-up-nvme-raid-z370-z390-chipset-motherboards.html">Set Up NVMe Raid on Z370/Z390 Motherboards</a></li><li class="list-group-item"><a href="/memory-setup-prestodb-cluster.html">Memory Configuration in Presto Cluster</a></li><li class="list-group-item"><a href="/connect-microsoft-access-hive-odbc-windows.html">Connect Microsoft Access to Hive with ODBC in Windows</a></li><li class="list-group-item"><a href="/prestodb-installation-setup-pitfalls.html">Presto Installation and Setup Pitfalls</a></li><li class="list-group-item"><a href="/access-minio-s3-storage-prestodb-cluster.html">Access MinIO S3 Storage in Presto Cluster</a></li></ul></li><li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categories</span></h4><ul class="list-group" id="categories"><li class="list-group-item"><a href="/category/cron.html"><i class="fa fa-folder-open fa-lg"></i>Cron</a></li><li class="list-group-item"><a href="/category/dbeaver.html"><i class="fa fa-folder-open fa-lg"></i>DBeaver</a></li><li class="list-group-item"><a href="/category/docker.html"><i class="fa fa-folder-open fa-lg"></i>Docker</a></li><li class="list-group-item"><a href="/category/google-analytics.html"><i class="fa fa-folder-open fa-lg"></i>Google Analytics</a></li><li class="list-group-item"><a href="/category/hardware.html"><i class="fa fa-folder-open fa-lg"></i>Hardware</a></li><li class="list-group-item"><a href="/category/hive.html"><i class="fa fa-folder-open fa-lg"></i>Hive</a></li><li class="list-group-item"><a href="/category/kerberos.html"><i class="fa fa-folder-open fa-lg"></i>Kerberos</a></li><li class="list-group-item"><a href="/category/linux.html"><i class="fa fa-folder-open fa-lg"></i>Linux</a></li><li class="list-group-item"><a href="/category/microsoft-access.html"><i class="fa fa-folder-open fa-lg"></i>Microsoft Access</a></li><li class="list-group-item"><a href="/category/microsoft-excel.html"><i class="fa fa-folder-open fa-lg"></i>Microsoft Excel</a></li><li class="list-group-item"><a href="/category/minio.html"><i class="fa fa-folder-open fa-lg"></i>MinIO</a></li><li class="list-group-item"><a href="/category/ms-sql-server.html"><i class="fa fa-folder-open fa-lg"></i>MS SQL Server</a></li><li class="list-group-item"><a href="/category/nginx.html"><i class="fa fa-folder-open fa-lg"></i>Nginx</a></li><li class="list-group-item"><a href="/category/presto.html"><i class="fa fa-folder-open fa-lg"></i>Presto</a></li><li class="list-group-item"><a href="/category/synology-dsm.html"><i class="fa fa-folder-open fa-lg"></i>Synology DSM</a></li><li class="list-group-item"><a href="/category/talend.html"><i class="fa fa-folder-open fa-lg"></i>Talend</a></li><li class="list-group-item"><a href="/category/virtualization.html"><i class="fa fa-folder-open fa-lg"></i>Virtualization</a></li><li class="list-group-item"><a href="/category/windows-tools.html"><i class="fa fa-folder-open fa-lg"></i>Windows Tools</a></li></ul></li></ul></section></aside></div></div></div><footer><div class="container"><hr><div class="row"><div class="col-xs-10">&copy; 2020 Vitaly Saversky &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>, <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>, <a href="http://getbootstrap.com" target="_blank">Bootstrap</a></div><div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i><a href="#">Back to top</a></p></div></div></div></footer><script src="/theme/js/jquery.min.js"></script><script src="/theme/js/bootstrap.min.js"></script><script src="/theme/js/respond.min.js"></script><script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'techjogging'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script><script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-156524189-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script><script src="/theme/js/report_access.js"></script><script type="text/javascript">
(function(w,d,s,g,js,fs){
  g=w.gapi||(w.gapi={});g.analytics={q:[],ready:function(f){this.q.push(f);}};
  js=d.createElement(s);fs=d.getElementsByTagName(s)[0];
  js.src='https://apis.google.com/js/platform.js';
  fs.parentNode.insertBefore(js,fs);js.onload=function(){g.load('analytics');};
}(window,document,'script'));
</script><script type="text/javascript">
gapi.analytics.ready(function() {

	  /**
	   * Authorize the user with an access token obtained server side.
	   */
	  gapi.analytics.auth.authorize({
	    'serverAuth': {
	      'access_token': ANALYTICS_TOKEN
	    }
	  });
	  
	  var pagePathFilter = 'ga:pagePath==' + window.location.pathname;
	  
	  var report = new gapi.analytics.report.Data({
		  query: {
		    ids: 'ga:209816969',
		    'start-date': '2020-02-29',
		    'end-date': 'today',
		    metrics: 'ga:pageviews',
		    filters: pagePathFilter
		  }
		});

		report.on('success', function(response) {
			pageViews = response.totalsForAllResults['ga:pageviews'];
			if (pageViews!='0') {
				$('#query-output').text(pageViews);
				for (pageviewsElement of document.getElementsByClassName('pageviews')){
					pageviewsElement.style.display='initial';
				}
			}
		});

		report.execute();

	  
	});
</script></body></html>