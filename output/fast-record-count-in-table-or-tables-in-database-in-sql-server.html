<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-Y8W3B3BXLX"></script><script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            
            gtag('config', 'G-Y8W3B3BXLX');
    </script><title>Fast Record Count in Table or Tables in Database in SQL Server - tech jogging</title><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="A personal blog includes technical articles aimed to share knowledge and experience with others."><link rel="canonical" href="https://techjogging.com/fast-record-count-in-table-or-tables-in-database-in-sql-server.html"><meta name="author" content="Vitaly Saversky"><meta name="description" content="As data size is growing each year, count record in a table takes more and more time if you use old fashion methods, for example, SELECT COUNT(*) FROM table. It's the most reliable method to get record count but if you deal with multi-billion record table, it might take hours …"><meta property="og:site_name" content="tech jogging"><meta property="og:type" content="article"><meta property="og:title" content="Fast Record Count in Table or Tables in Database in SQL Server"><meta property="og:url" content="https://techjogging.com/fast-record-count-in-table-or-tables-in-database-in-sql-server.html"><meta property="og:description" content="As data size is growing each year, count record in a table takes more and more time if you use old fashion methods, for example, SELECT COUNT(*) FROM table. It's the most reliable method to get record count but if you deal with multi-billion record table, it might take hours …"><meta property="article:published_time" content="2020-04-06"><meta property="article:section" content="MS SQL Server"><meta property="article:author" content="Vitaly Saversky"><link rel="stylesheet" href="https://techjogging.com/theme/css/bootstrap.flatly.min.css" type="text/css"><link href="https://techjogging.com/theme/css/font-awesome.min.css" rel="stylesheet"><link href="https://techjogging.com/theme/css/pygments/monokai.css" rel="stylesheet"><link href="https://techjogging.com/theme/tipuesearch/tipuesearch.css" rel="stylesheet"><link rel="stylesheet" href="https://techjogging.com/theme/css/style.css" type="text/css"></head><body><div class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="https://techjogging.com/" class="navbar-brand"><img alt="tech jogging" class="img-responsive pull-left gap-right" src="https://techjogging.com/extra/site-logo.png" width> tech jogging </a></div><div class="collapse navbar-collapse navbar-ex1-collapse"><ul class="nav navbar-nav"><li><a href="https://techjogging.com/pages/about-blog.html"> About blog </a></li></ul><ul class="nav navbar-nav navbar-right"><li><span><form class="navbar-search" action="/search.html"><input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" pattern=".{3,}" title="At least 3 characters" required><button type="submit" class="tipue_search_button"><div class="tipue_search_icon">&#9906;</div></button></form></span></li></ul></div></div></div><div class="container"><div class="row"><div class="col-sm-9"><section id="content"><article><header class="page-header"><h1><a href="https://techjogging.com/fast-record-count-in-table-or-tables-in-database-in-sql-server.html" rel="bookmark" title="Permalink to Fast Record Count in Table or Tables in Database in SQL Server"> Fast Record Count in Table or Tables in Database in SQL Server </a></h1></header><div class="entry-content"><div class="panel"><div class="panel-body"><footer class="post-info"><span class="label label-default">Date</span><span class="published article-info-label"><i class="fa fa-calendar"></i><time datetime="2020-04-06T00:00:00-04:00"> 2020-04-06</time></span><span class="label label-default pageviews">Views</span><span class="article-info-label pageviews"><span class="badge pageviews" id="query-output"></span></span><span class="label label-default">Category</span><span class="article-info-label"><a href="https://techjogging.com/category/ms-sql-server.html">MS SQL Server</a></span></footer></div></div><p>As data size is growing each year, count record in a table takes more and more time if you use old fashion methods, for example, <code>SELECT COUNT(*) FROM table</code>. It's the most reliable method to get record count but if you deal with multi-billion record table, it might take hours to get your result. Also, you need to consider that <code>COUNT(*)</code> operator is resource consuming as MS SQL Server has to scan every record in worst scenario. Moreover, <code>COUNT(*)</code> calculation locks a table which impacts on overall performance.</p><p>Meta data is a good source of information without workloading our SQL Server and getting results in no time. One drawback is that we might get "dirty" numbers because meta data is not aware of transactions which might occur during retrieving of record count. If we look at "dirty" numbers from another point of view, we can accept it. Let's imagine that we need to check our progress on inserting record in a table, we don't need exact number, we need to get a number to evaluate our current progress. Another case is when we have completed data transformation on a big table, we need to validate our result with record count. We know exactly that we don't do any data modification on the table and we are safe to use meta data.</p><p>To get record count fast, we need to consider a case when meta data might be locked and getting record count quickly will be problematic. It can be solved by reading uncommitted ("dirty") data with <code>NOLOCK</code> or <code>READUNCOMMITTED</code> hint.</p><p>An exception is when <code>TABLOCK</code> hint is used on your table. It will lock access to the table completely.</p><h2>1. Count Records in a Table</h2><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="k">SCHEMA_NAME</span><span class="p">(</span><span class="n">schema_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">t</span><span class="p">.</span><span class="n">name</span> <span class="k">AS</span> <span class="p">[</span><span class="k">Table</span> <span class="n">Name</span><span class="p">],</span>
       <span class="n">FORMAT</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">p</span><span class="p">.[</span><span class="k">rows</span><span class="p">]),</span> <span class="s1">&#39;#,#&#39;</span><span class="p">)</span> <span class="k">AS</span> <span class="p">[</span><span class="k">Row</span> <span class="k">Count</span><span class="p">]</span>
<span class="k">FROM</span> <span class="n">sys</span><span class="p">.</span><span class="n">tables</span> <span class="n">t</span> <span class="k">WITH</span> <span class="p">(</span><span class="n">NOLOCK</span><span class="p">)</span> <span class="k">JOIN</span> <span class="n">sys</span><span class="p">.</span><span class="n">partitions</span> <span class="n">p</span> <span class="k">WITH</span> <span class="p">(</span><span class="n">NOLOCK</span><span class="p">)</span> <span class="k">ON</span> <span class="n">t</span><span class="p">.[</span><span class="n">object_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">.[</span><span class="n">object_id</span><span class="p">]</span>
                                                                       <span class="k">AND</span> <span class="n">p</span><span class="p">.</span><span class="n">index_id</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">WHERE</span> <span class="n">t</span><span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;$(Table name)&#39;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">t</span><span class="p">.[</span><span class="n">schema_id</span><span class="p">]</span>
        <span class="p">,</span><span class="n">t</span><span class="p">.[</span><span class="n">name</span><span class="p">];</span>
</pre></div><p>Replace <strong>$(Table name)</strong> place holder with your table name.</p><h2>2. Count Record in User Tables in a Database</h2><div class="highlight"><pre><span></span><span class="k">DECLARE</span> <span class="o">@</span><span class="n">SqlText</span> <span class="n">NVARCHAR</span><span class="p">(</span><span class="k">MAX</span><span class="p">);</span>

<span class="k">SELECT</span> <span class="o">@</span><span class="n">SqlText</span> <span class="o">=</span> <span class="n">COALESCE</span><span class="p">(</span><span class="o">@</span><span class="n">SqlText</span> <span class="o">+</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;UNION ALL&#39;</span> <span class="o">+</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">13</span><span class="p">),</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
       <span class="o">+</span> <span class="s1">&#39;SELECT SCHEMA_NAME(schema_id) + &#39;&#39;.&#39;&#39; + t.name AS [Table Name],&#39;</span>
       <span class="o">+</span>        <span class="s1">&#39;FORMAT(SUM(p.[rows]), &#39;&#39;#,#&#39;&#39;) AS [Row Count] &#39;</span>
       <span class="o">+</span> <span class="s1">&#39;FROM sys.tables t WITH (NOLOCK) JOIN sys.partitions p WITH (NOLOCK) ON t.[object_id] = p.[object_id] &#39;</span>
       <span class="o">+</span>                                                                        <span class="s1">&#39;AND p.index_id IN (0, 1) &#39;</span>
       <span class="o">+</span> <span class="s1">&#39;WHERE t.name=&#39;&#39;&#39;</span> <span class="o">+</span> <span class="n">l</span><span class="p">.[</span><span class="n">name</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&#39;&#39; &#39;</span>
       <span class="o">+</span>       <span class="s1">&#39;AND t.[schema_id]=&#39;</span> <span class="o">+</span> <span class="k">CAST</span><span class="p">(</span><span class="n">l</span><span class="p">.[</span><span class="n">schema_id</span><span class="p">]</span> <span class="k">AS</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
       <span class="o">+</span> <span class="s1">&#39;GROUP BY [schema_id]&#39;</span>
       <span class="o">+</span>         <span class="s1">&#39;,t.[name]&#39;</span>
<span class="k">FROM</span> <span class="n">sys</span><span class="p">.</span><span class="n">tables</span> <span class="n">l</span> <span class="k">WITH</span> <span class="p">(</span><span class="n">NOLOCK</span><span class="p">)</span>
<span class="k">WHERE</span> <span class="p">[</span><span class="k">type</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;U&#39;</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">SCHEMA_NAME</span><span class="p">([</span><span class="n">schema_id</span><span class="p">])</span>
        <span class="p">,[</span><span class="n">name</span><span class="p">];</span>

<span class="k">EXEC</span> <span class="n">sp_executesql</span> <span class="o">@</span><span class="n">SqlText</span>
</pre></div></div><hr><section class="comments" id="comments"><h2>Comments</h2><div id="disqus_thread"></div><script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'techjogging'; // required: replace example with your forum shortname

            var disqus_config = function () {
                this.language = "en";

                        this.page.identifier = '2020-04-06-fast-record-count-in-table-or-tables-in-database-in-sql-server';
                        this.page.url = 'https://techjogging.com/fast-record-count-in-table-or-tables-in-database-in-sql-server.html';
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></section></article></section></div><div class="col-sm-3" id="sidebar"><aside><section class="well well-sm"><ul class="list-group list-group-flush"><li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4><ul class="list-group" id="recentposts"><li class="list-group-item"><a href="https://techjogging.com/install-self-host-prefect-server.html">Install Self-hosted Prefect Server</a></li><li class="list-group-item"><a href="https://techjogging.com/common-table-expressions-in-trino.html">Common Table Expressions in Trino</a></li><li class="list-group-item"><a href="https://techjogging.com/embed-google-universal-analytics-pageviews-static-web-site.html">Embed Google Universal Analytics Pageviews in Static Web Site</a></li><li class="list-group-item"><a href="https://techjogging.com/add-google-analytics-4-pageviews-static-web-site.html">Add Google Analytics 4 Pageviews in Static Web Site</a></li><li class="list-group-item"><a href="https://techjogging.com/migration-trino-iceberg-table-format.html">Migration to Trino Iceberg Table Format</a></li></ul></li><li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categories</span></h4><ul class="list-group" id="categories"><li class="list-group-item"><a href="https://techjogging.com/category/cobol.html"><i class="fa fa-folder-open fa-lg"></i>COBOL</a></li><li class="list-group-item"><a href="https://techjogging.com/category/cron.html"><i class="fa fa-folder-open fa-lg"></i>Cron</a></li><li class="list-group-item"><a href="https://techjogging.com/category/dbeaver.html"><i class="fa fa-folder-open fa-lg"></i>DBeaver</a></li><li class="list-group-item"><a href="https://techjogging.com/category/docker.html"><i class="fa fa-folder-open fa-lg"></i>Docker</a></li><li class="list-group-item"><a href="https://techjogging.com/category/git.html"><i class="fa fa-folder-open fa-lg"></i>Git</a></li><li class="list-group-item"><a href="https://techjogging.com/category/google-analytics.html"><i class="fa fa-folder-open fa-lg"></i>Google Analytics</a></li><li class="list-group-item"><a href="https://techjogging.com/category/hardware.html"><i class="fa fa-folder-open fa-lg"></i>Hardware</a></li><li class="list-group-item"><a href="https://techjogging.com/category/hive.html"><i class="fa fa-folder-open fa-lg"></i>Hive</a></li><li class="list-group-item"><a href="https://techjogging.com/category/hubitat.html"><i class="fa fa-folder-open fa-lg"></i>Hubitat</a></li><li class="list-group-item"><a href="https://techjogging.com/category/kerberos.html"><i class="fa fa-folder-open fa-lg"></i>Kerberos</a></li><li class="list-group-item"><a href="https://techjogging.com/category/linux.html"><i class="fa fa-folder-open fa-lg"></i>Linux</a></li><li class="list-group-item"><a href="https://techjogging.com/category/microsoft-access.html"><i class="fa fa-folder-open fa-lg"></i>Microsoft Access</a></li><li class="list-group-item"><a href="https://techjogging.com/category/microsoft-excel.html"><i class="fa fa-folder-open fa-lg"></i>Microsoft Excel</a></li><li class="list-group-item"><a href="https://techjogging.com/category/minio.html"><i class="fa fa-folder-open fa-lg"></i>MinIO</a></li><li class="list-group-item"><a href="https://techjogging.com/category/ms-sql-server.html"><i class="fa fa-folder-open fa-lg"></i>MS SQL Server</a></li><li class="list-group-item"><a href="https://techjogging.com/category/networking.html"><i class="fa fa-folder-open fa-lg"></i>Networking</a></li><li class="list-group-item"><a href="https://techjogging.com/category/nginx.html"><i class="fa fa-folder-open fa-lg"></i>Nginx</a></li><li class="list-group-item"><a href="https://techjogging.com/category/prefect.html"><i class="fa fa-folder-open fa-lg"></i>Prefect</a></li><li class="list-group-item"><a href="https://techjogging.com/category/python.html"><i class="fa fa-folder-open fa-lg"></i>Python</a></li><li class="list-group-item"><a href="https://techjogging.com/category/security.html"><i class="fa fa-folder-open fa-lg"></i>Security</a></li><li class="list-group-item"><a href="https://techjogging.com/category/surveillance.html"><i class="fa fa-folder-open fa-lg"></i>Surveillance</a></li><li class="list-group-item"><a href="https://techjogging.com/category/synology-dsm.html"><i class="fa fa-folder-open fa-lg"></i>Synology DSM</a></li><li class="list-group-item"><a href="https://techjogging.com/category/talend.html"><i class="fa fa-folder-open fa-lg"></i>Talend</a></li><li class="list-group-item"><a href="https://techjogging.com/category/trino.html"><i class="fa fa-folder-open fa-lg"></i>Trino</a></li><li class="list-group-item"><a href="https://techjogging.com/category/virtualization.html"><i class="fa fa-folder-open fa-lg"></i>Virtualization</a></li><li class="list-group-item"><a href="https://techjogging.com/category/windows.html"><i class="fa fa-folder-open fa-lg"></i>Windows</a></li></ul></li></ul></section></aside></div></div></div><footer><div class="container"><hr><div class="row"><div class="col-xs-10">&copy; 2024 Vitaly Saversky &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>, <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>, <a href="http://getbootstrap.com" target="_blank">Bootstrap</a></div><div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i><a href="#">Back to top</a></p></div></div></div></footer><script src="https://techjogging.com/theme/js/jquery.min.js"></script><script src="https://techjogging.com/theme/js/bootstrap.min.js"></script><script src="https://techjogging.com/theme/js/respond.min.js"></script><script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'techjogging'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script><script src="https://techjogging.com/theme/js/report_access.js"></script><script src="https://techjogging.com/theme/js/blog_metrics.js"></script><script src="https://techjogging.com/theme/js/blog_metrics_universal.js"></script><script type="text/javascript">
window.addEventListener('DOMContentLoaded', function () {
	pagePath = window.location.pathname;
	pageViewsAnalytics4 = 0;
	pageViewsAnalyticsUniversal = 0;
	
	if (blog_views_universal.get(pagePath)) {
		pageViewsAnalyticsUniversal = blog_views_universal.get(pagePath); 
	}
	
	if (blog_views.get(pagePath)) {
		pageViewsAnalytics4 = blog_views.get(pagePath); 
	}
	
	pageViewTotal = +pageViewsAnalyticsUniversal + +pageViewsAnalytics4;
	if (pageViewTotal!='0') {
		formattedPageViewTotal = pageViewTotal.toLocaleString('en-US');
		$('#query-output').text(formattedPageViewTotal);
		for (pageviewsElement of document.getElementsByClassName('pageviews')){
			pageviewsElement.style.display='initial';
		}
	}
	
});
</script></body></html>