<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-Y8W3B3BXLX"></script><script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            
            gtag('config', 'G-Y8W3B3BXLX');
    </script><title>Access SQL Server with Trusted Connection in Linux with Python Using Kerberos Keytab - tech jogging</title><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="A personal blog includes technical articles aimed to share knowledge and experience with others."><link rel="canonical" href="https://techjogging.com/access-sqlserver-trusted-connection-linux-python-kerberos-keytab.html"><meta name="author" content="Vitaly Saversky"><meta name="description" content="When supplying credentials in plain text in Python applications and tools are a concern of the security policy in your company, Kerberos keytab might be a relief. Kerberos keytab hides sensitive information and it serves as a password to authenticate access to different resources. In other words, a keytab is …"><meta property="og:site_name" content="tech jogging"><meta property="og:type" content="article"><meta property="og:title" content="Access SQL Server with Trusted Connection in Linux with Python Using Kerberos Keytab"><meta property="og:url" content="https://techjogging.com/access-sqlserver-trusted-connection-linux-python-kerberos-keytab.html"><meta property="og:description" content="When supplying credentials in plain text in Python applications and tools are a concern of the security policy in your company, Kerberos keytab might be a relief. Kerberos keytab hides sensitive information and it serves as a password to authenticate access to different resources. In other words, a keytab is …"><meta property="article:published_time" content="2021-09-07"><meta property="article:section" content="Python"><meta property="article:author" content="Vitaly Saversky"><link rel="stylesheet" href="https://techjogging.com/theme/css/bootstrap.flatly.min.css" type="text/css"><link href="https://techjogging.com/theme/css/font-awesome.min.css" rel="stylesheet"><link href="https://techjogging.com/theme/css/pygments/monokai.css" rel="stylesheet"><link href="https://techjogging.com/theme/tipuesearch/tipuesearch.css" rel="stylesheet"><link rel="stylesheet" href="https://techjogging.com/theme/css/style.css" type="text/css"></head><body><div class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="https://techjogging.com/" class="navbar-brand"><img alt="tech jogging" class="img-responsive pull-left gap-right" src="https://techjogging.com/extra/site-logo.png" width> tech jogging </a></div><div class="collapse navbar-collapse navbar-ex1-collapse"><ul class="nav navbar-nav"><li><a href="https://techjogging.com/pages/about-blog.html"> About blog </a></li></ul><ul class="nav navbar-nav navbar-right"><li><span><form class="navbar-search" action="/search.html"><input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" pattern=".{3,}" title="At least 3 characters" required><button type="submit" class="tipue_search_button"><div class="tipue_search_icon">&#9906;</div></button></form></span></li></ul></div></div></div><div class="container"><div class="row"><div class="col-sm-9"><section id="content"><article><header class="page-header"><h1><a href="https://techjogging.com/access-sqlserver-trusted-connection-linux-python-kerberos-keytab.html" rel="bookmark" title="Permalink to Access SQL Server with Trusted Connection in Linux with Python Using Kerberos Keytab"> Access SQL Server with Trusted Connection in Linux with Python Using Kerberos Keytab </a></h1></header><div class="entry-content"><div class="panel"><div class="panel-body"><footer class="post-info"><span class="label label-default">Date</span><span class="published article-info-label"><i class="fa fa-calendar"></i><time datetime="2021-09-07T00:00:00-04:00"> 2021-09-07</time></span><span class="label label-default">Modified</span><span class="modified article-info-label"><i class="fa fa-calendar"></i><time datetime="2021-09-30T00:00:00-04:00"> 2021-09-30</time></span><span class="label label-default pageviews">Views</span><span class="article-info-label pageviews"><span class="badge pageviews" id="query-output"></span></span><span class="label label-default">Category</span><span class="article-info-label"><a href="https://techjogging.com/category/python.html">Python</a>, <a href="https://techjogging.com/category/ms-sql-server.html">MS SQL Server</a>, <a href="https://techjogging.com/category/kerberos.html">Kerberos</a></span></footer></div></div><p>When supplying credentials in plain text in Python applications and tools are a concern of the security policy in your company, Kerberos keytab might be a relief. Kerberos keytab hides sensitive information and it serves as a password to authenticate access to different resources. In other words, a keytab is a password replacement.</p><p>The most common use case is a service account when an application utilizes a special account. All users who run an application are authenticated with the same service account. It is convenient way to access, for example, data located on SQL Server.</p><p>The sample code is developed in CentOS 7 with Python 3 and pyodbc library. </p><h2>Prerequisites</h2><ul><li><p>Install Kerberos client.</p><div class="highlight"><pre><span></span>sudo yum install krb5-workstation krb5-libs
</pre></div></li><li><p>Install ODBC on non MS Windows platforms.</p><div class="highlight"><pre><span></span>sudo yum install unixODBC-devel
</pre></div></li><li><p>Install Microsoft ODBC driver for SQL Server.</p><p>The sample uses ODBC driver version 13 but the latest version is 17. </p><div class="highlight"><pre><span></span>sudo rpm -i https://packages.microsoft.com/rhel/7/prod/msodbcsql-13.1.9.2-1.x86_64.rpm
</pre></div><p>If you decide for the latest ODBC driver, get one from <a href="https://docs.microsoft.com/en-us/sql/connect/odbc/download-odbc-driver-for-sql-server">Download ODBC Driver for SQL Server</a>.</p></li><li><p>Install Python pyodbc library</p><div class="highlight"><pre><span></span>pip install pyodbc
</pre></div></li><li><p>Create a Kerberos keytab</p><p>Follow steps in <a href="https://techjogging.com/create-keytab-file-kerberos-authentication-linux.html">Create Keytab for Kerberos Authentication in Linux</a> or <a href="https://techjogging.com/create-keytab-file-for-kerberos-authentication-in-windows.html">Create Keytab for Kerberos Authentication in Windows</a>.</p></li></ul><h2>Sample</h2><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyodbc</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">createKerberosTicket</span><span class="p">(</span><span class="n">user_full_name</span><span class="p">,</span> <span class="n">keytab_path</span><span class="p">):</span>

    <span class="n">error_code</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;kinit {user_full_name} -k -t {keytab_path}&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">error_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;kinit error: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error_code</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">error_code</span>

<span class="k">def</span> <span class="nf">sqlserver_connection</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;Driver={ODBC Driver 13 for SQL Server};Server=&quot;</span> <span class="o">+</span> <span class="s1">&#39;sqlserver.sample.com&#39;</span> <span class="o">+</span> \
                                <span class="s2">&quot;;Database=&quot;</span> <span class="o">+</span> <span class="s1">&#39;master&#39;</span> <span class="o">+</span> \
                                <span class="s2">&quot;;Trusted_Connection=yes&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">user_name</span> <span class="o">=</span> <span class="s1">&#39;sampleuser&#39;</span>
    <span class="n">keytab_path</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;/home/sampleuser/{user_name}.keytab&#39;</span>
    <span class="n">domain_name</span> <span class="o">=</span> <span class="s1">&#39;SAMPLE.COM&#39;</span>
    <span class="n">user_full_name</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;{user_name}@{domain_name}&#39;</span>

    <span class="n">createKerberosTicket</span><span class="p">(</span><span class="n">user_full_name</span><span class="p">,</span> <span class="n">keytab_path</span><span class="p">)</span>

    <span class="n">cur</span> <span class="o">=</span> <span class="n">sqlserver_connection</span><span class="p">()</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

    <span class="n">sql_text</span> <span class="o">=</span> <span class="s1">&#39;SELECT @@VERSION&#39;</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_text</span><span class="p">)</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

    <span class="k">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div><h2>Troubleshooting</h2><ul><li><p>Error message</p><div class="highlight"><pre><span></span>pyodbc.OperationalError: (&#39;HYT00&#39;, &#39;[HYT00] [unixODBC][Microsoft][ODBC Driver 13 for SQL Server]Login timeout expired (0) (SQLDriverConnect)&#39;)
</pre></div><p>One of the reasons is your SQL Server name. Make sure that it is used Fully Qualified Domain Name (FQDN), for example, <code>sqlserver.sample.com</code>.</p></li><li><p>Check Kerberos ticket(s) created by an application. Open terminal and run commands.</p><div class="highlight"><pre><span></span>klist
</pre></div></li><li><p>Missing Kerberos ticket cache file variable.</p><p>It might be requested to create <code>KRB5CCNAME</code> variable with location and name of Kerberos ticket cache file. See more details in <a href="https://techjogging.com/create-ticket-cache-kerberos-authentication-linux.html">Create Ticket Cache File for Kerberos Authentication in Linux </a> article.</p></li><li><p>Missing krb5.conf Kerberos configuration file. </p><p>The file contains default realm and Kerberos ticket settings. See more details in <a href="https://techjogging.com/create-ticket-cache-kerberos-authentication-linux.html">Create Ticket Cache File for Kerberos Authentication in Linux </a> article.</p></li></ul><h2>Resources</h2><ul><li><a href="https://github.com/mkleehammer/pyodbc">pyodbc</a></li><li><a href="https://web.mit.edu/kerberos/krb5-1.12/doc/user/user_commands/kinit.html">kinit - MIT Kerberos Documentation</a></li><li><a href="https://web.mit.edu/kerberos/krb5-1.12/doc/user/user_commands/klist.html">klist - MIT Kerberos Documentation</a></li><li><a href="https://docs.microsoft.com/en-us/sql/connect/odbc/microsoft-odbc-driver-for-sql-server">Microsoft ODBC Driver for SQL Server</a></li><li><a href="https://techjogging.com/create-keytab-file-kerberos-authentication-linux.html">Create Keytab for Kerberos Authentication in Linux</a></li><li><a href="https://techjogging.com/create-keytab-file-for-kerberos-authentication-in-windows.html">Create Keytab for Kerberos Authentication in Windows</a></li><li><a href="https://techjogging.com/create-ticket-cache-kerberos-authentication-linux.html">Create Ticket Cache File for Kerberos Authentication in Linux </a></li></ul></div><hr><section class="comments" id="comments"><h2>Comments</h2><div id="disqus_thread"></div><script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'techjogging'; // required: replace example with your forum shortname

            var disqus_config = function () {
                this.language = "en";

                        this.page.identifier = '2021-09-07-access-sqlserver-trusted-connection-linux-python-kerberos-keytab';
                        this.page.url = 'https://techjogging.com/access-sqlserver-trusted-connection-linux-python-kerberos-keytab.html';
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></section></article></section></div><div class="col-sm-3" id="sidebar"><aside><section class="well well-sm"><ul class="list-group list-group-flush"><li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4><ul class="list-group" id="recentposts"><li class="list-group-item"><a href="https://techjogging.com/dbeaver_eclipse_file_is_out_of_date_svn_error.html">DBeaver/Eclipse "File is out of date" SVN Error</a></li><li class="list-group-item"><a href="https://techjogging.com/set-up-tplink-router-access-point.html">Set Up TP-Link Router as Access Point</a></li><li class="list-group-item"><a href="https://techjogging.com/rename-worksheet-dynamically-excel.html">Rename Worksheet Dynamically in Excel</a></li><li class="list-group-item"><a href="https://techjogging.com/get-started-custom-connector-plugin-trino.html">Get Started with Custom Connector Plugin in Trino</a></li><li class="list-group-item"><a href="https://techjogging.com/use_https_protocol_trino_server_pkcs12_store.html">Use HTTPS Protocol in Trino Server with PKCS 12 Store</a></li></ul></li><li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categories</span></h4><ul class="list-group" id="categories"><li class="list-group-item"><a href="https://techjogging.com/category/cobol.html"><i class="fa fa-folder-open fa-lg"></i>COBOL</a></li><li class="list-group-item"><a href="https://techjogging.com/category/cron.html"><i class="fa fa-folder-open fa-lg"></i>Cron</a></li><li class="list-group-item"><a href="https://techjogging.com/category/dbeaver.html"><i class="fa fa-folder-open fa-lg"></i>DBeaver</a></li><li class="list-group-item"><a href="https://techjogging.com/category/docker.html"><i class="fa fa-folder-open fa-lg"></i>Docker</a></li><li class="list-group-item"><a href="https://techjogging.com/category/git.html"><i class="fa fa-folder-open fa-lg"></i>Git</a></li><li class="list-group-item"><a href="https://techjogging.com/category/google-analytics.html"><i class="fa fa-folder-open fa-lg"></i>Google Analytics</a></li><li class="list-group-item"><a href="https://techjogging.com/category/hardware.html"><i class="fa fa-folder-open fa-lg"></i>Hardware</a></li><li class="list-group-item"><a href="https://techjogging.com/category/hive.html"><i class="fa fa-folder-open fa-lg"></i>Hive</a></li><li class="list-group-item"><a href="https://techjogging.com/category/hubitat.html"><i class="fa fa-folder-open fa-lg"></i>Hubitat</a></li><li class="list-group-item"><a href="https://techjogging.com/category/kerberos.html"><i class="fa fa-folder-open fa-lg"></i>Kerberos</a></li><li class="list-group-item"><a href="https://techjogging.com/category/linux.html"><i class="fa fa-folder-open fa-lg"></i>Linux</a></li><li class="list-group-item"><a href="https://techjogging.com/category/microsoft-access.html"><i class="fa fa-folder-open fa-lg"></i>Microsoft Access</a></li><li class="list-group-item"><a href="https://techjogging.com/category/microsoft-excel.html"><i class="fa fa-folder-open fa-lg"></i>Microsoft Excel</a></li><li class="list-group-item"><a href="https://techjogging.com/category/minio.html"><i class="fa fa-folder-open fa-lg"></i>MinIO</a></li><li class="list-group-item"><a href="https://techjogging.com/category/ms-sql-server.html"><i class="fa fa-folder-open fa-lg"></i>MS SQL Server</a></li><li class="list-group-item"><a href="https://techjogging.com/category/networking.html"><i class="fa fa-folder-open fa-lg"></i>Networking</a></li><li class="list-group-item"><a href="https://techjogging.com/category/nginx.html"><i class="fa fa-folder-open fa-lg"></i>Nginx</a></li><li class="list-group-item"><a href="https://techjogging.com/category/python.html"><i class="fa fa-folder-open fa-lg"></i>Python</a></li><li class="list-group-item"><a href="https://techjogging.com/category/security.html"><i class="fa fa-folder-open fa-lg"></i>Security</a></li><li class="list-group-item"><a href="https://techjogging.com/category/surveillance.html"><i class="fa fa-folder-open fa-lg"></i>Surveillance</a></li><li class="list-group-item"><a href="https://techjogging.com/category/synology-dsm.html"><i class="fa fa-folder-open fa-lg"></i>Synology DSM</a></li><li class="list-group-item"><a href="https://techjogging.com/category/talend.html"><i class="fa fa-folder-open fa-lg"></i>Talend</a></li><li class="list-group-item"><a href="https://techjogging.com/category/trino.html"><i class="fa fa-folder-open fa-lg"></i>Trino</a></li><li class="list-group-item"><a href="https://techjogging.com/category/virtualization.html"><i class="fa fa-folder-open fa-lg"></i>Virtualization</a></li><li class="list-group-item"><a href="https://techjogging.com/category/windows.html"><i class="fa fa-folder-open fa-lg"></i>Windows</a></li></ul></li></ul></section></aside></div></div></div><footer><div class="container"><hr><div class="row"><div class="col-xs-10">&copy; 2024 Vitaly Saversky &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>, <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>, <a href="http://getbootstrap.com" target="_blank">Bootstrap</a></div><div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i><a href="#">Back to top</a></p></div></div></div></footer><script src="https://techjogging.com/theme/js/jquery.min.js"></script><script src="https://techjogging.com/theme/js/bootstrap.min.js"></script><script src="https://techjogging.com/theme/js/respond.min.js"></script><script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'techjogging'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script><script src="https://techjogging.com/theme/js/report_access.js"></script><script src="https://techjogging.com/theme/js/blog_metrics.js"></script><script type="text/javascript">
(function(w,d,s,g,js,fs){
  g=w.gapi||(w.gapi={});g.analytics={q:[],ready:function(f){this.q.push(f);}};
  js=d.createElement(s);fs=d.getElementsByTagName(s)[0];
  js.src='https://apis.google.com/js/platform.js';
  fs.parentNode.insertBefore(js,fs);js.onload=function(){g.load('analytics');};
}(window,document,'script'));
</script><script type="text/javascript">
gapi.analytics.ready(function() {

	  gapi.analytics.auth.authorize({
	    'serverAuth': {
	      'access_token': ANALYTICS_TOKEN
	    }
	  });
	  
	  var pagePathFilter = 'ga:pagePath==' + window.location.pathname;
	  
	  var report = new gapi.analytics.report.Data({
		  query: {
		    ids: 'ga:209816969',
		    'start-date': '2020-02-29',
		    'end-date': 'today',
		    metrics: 'ga:pageviews',
		    filters: pagePathFilter
		  }
		});

		report.on('success', function(response) {
			pageViews = response.totalsForAllResults['ga:pageviews'];
			pagePath = window.location.pathname
			pageViewsAnalytics4 = 0
			
			if (blog_views.get(pagePath)) {
				pageViewsAnalytics4 = blog_views.get(pagePath); 
			}
			
			pageViewTotal = +pageViews + +pageViewsAnalytics4
			if (pageViewTotal!='0') {
				formattedPageViewTotal = pageViewTotal.toLocaleString('en-US');
				$('#query-output').text(formattedPageViewTotal);
				for (pageviewsElement of document.getElementsByClassName('pageviews')){
					pageviewsElement.style.display='initial';
				}
			}
		});

		report.execute();

	  
	});
</script></body></html>